import os
import json
from dotenv import load_dotenv
from typing import List, Dict, Any, Optional

# Загрузка переменных окружения из файла .env
load_dotenv()

# Основные настройки
TELEGRAM_BOT_TOKEN = os.getenv("TELEGRAM_BOT_TOKEN")
GITHUB_TOKEN = os.getenv("GITHUB_TOKEN")
GITHUB_REPO = "robinso1/botigor2"
DATABASE_URL = os.getenv("DATABASE_URL", "sqlite:///./bot.db")
SECRET_KEY = os.getenv("SECRET_KEY", "your-secret-key-here")

# Преобразование строки с ID администраторов в список
ADMIN_IDS_STR = os.getenv("ADMIN_IDS", "[]")
try:
    ADMIN_IDS = json.loads(ADMIN_IDS_STR)
except json.JSONDecodeError:
    ADMIN_IDS = []

# Настройки демо-режима
DEMO_MODE = os.getenv("DEMO_MODE", "False").lower() in ("true", "1", "t")
DEMO_REQUESTS_PER_DAY = (3, 5)  # Минимальное и максимальное количество демо-заявок в день
DEMO_PHONE_MASK_PERCENT = 60  # Процент скрытия номера телефона

# Настройки распределения заявок
DEFAULT_DISTRIBUTION_INTERVAL = 3  # Интервал распределения заявок в часах
DEFAULT_USERS_PER_REQUEST = 3  # Основной поток: до 3 пользователей
RESERVE_USERS_PER_REQUEST = 2  # Резервный поток: до 2 дополнительных
DEFAULT_MAX_DISTRIBUTIONS = 5  # Максимальное количество распределений одной заявки

# Настройки для мониторинга чатов
MONITORED_CHATS: List[int] = []  # ID чатов для мониторинга заявок

# Статусы заявок
REQUEST_STATUSES = [
    "новая",
    "актуальная",
    "неактуальная",
    "в работе",
    "замер",
    "отказ клиента",
    "завершена",
    "ожидание подтверждения"
]

# Префиксы мобильных номеров по городам
CITY_PHONE_PREFIXES = {
    "Москва": ["495", "499", "496"],
    "Санкт-Петербург": ["812", "921", "911"],
    "Екатеринбург": ["343", "922", "912"],
    "Новосибирск": ["383", "923", "913"],
    "Казань": ["843", "917", "919"]
}

# Категории услуг
DEFAULT_CATEGORIES = [
    # Сантехника: Установка и монтаж
    "Установка душевой кабины",
    "Монтаж инсталляции",
    "Установка унитаза",
    "Установка ванны",
    "Монтаж бойлера",
    "Установка смесителя",
    "Установка раковины",
    "Монтаж батарей",
    # Разводка и коммуникации
    "Разводка труб ГВС/ХВС",
    "Пайка ПП труб",
    "Монтаж металлопласта",
    "Монтаж сшитого полиэтилена",
    "Установка теплых полов",
    # Комплексные услуги
    "Сантехника под ключ",
    # Дополнительные услуги
    "Остекление балконов",
    "Остекление лоджий",
    "Натяжные потолки",
    "Дизайн интерьера",
    "Кухни на заказ",
    "Ремонт квартир под ключ"
]

# Города (будут настраиваться через админ-панель)
DEFAULT_CITIES = [
    "Москва",
    "Санкт-Петербург",
    "Екатеринбург",
    "Новосибирск",
    "Казань"
]

# Настройки веб-сервера для админ-панели
ADMIN_HOST = "0.0.0.0"
ADMIN_PORT = 8000

# Настройки GitHub
GITHUB_SYNC_INTERVAL = 15  # Интервал синхронизации с GitHub в минутах 