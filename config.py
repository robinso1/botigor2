import os
import json
from dotenv import load_dotenv
from typing import List, Dict, Any, Optional

# Загрузка переменных окружения из файла .env
load_dotenv()

# Основные настройки
TELEGRAM_BOT_TOKEN = os.getenv("TELEGRAM_BOT_TOKEN")
GITHUB_TOKEN = os.getenv("GITHUB_TOKEN")
GITHUB_REPO = "robinso1/botigor2"
DATABASE_URL = os.getenv("DATABASE_URL", "sqlite:///./bot.db")
SECRET_KEY = os.getenv("SECRET_KEY", "your-secret-key-here")

# Преобразование строки с ID администраторов в список
ADMIN_IDS_STR = os.getenv("ADMIN_IDS", "[]")
try:
    ADMIN_IDS = json.loads(ADMIN_IDS_STR)
except json.JSONDecodeError:
    ADMIN_IDS = []

# Настройки демо-режима
DEMO_MODE = os.getenv("DEMO_MODE", "False").lower() in ("true", "1", "t")
DEMO_REQUESTS_PER_DAY = (3, 5)  # Минимальное и максимальное количество демо-заявок в день
DEMO_PHONE_MASK_PERCENT = 60  # Процент скрытия номера телефона

# Настройки распределения заявок
DEFAULT_DISTRIBUTION_INTERVAL = 3  # Интервал распределения заявок в часах
DEFAULT_USERS_PER_REQUEST = 3  # Основной поток: до 3 пользователей
RESERVE_USERS_PER_REQUEST = 2  # Резервный поток: до 2 дополнительных
DEFAULT_MAX_DISTRIBUTIONS = 5  # Максимальное количество распределений одной заявки

# Настройки для мониторинга чатов
MONITORED_CHATS: List[int] = []  # ID чатов для мониторинга заявок

# Статусы заявок
REQUEST_STATUSES = [
    "новая",
    "актуальная",
    "неактуальная",
    "в работе",
    "замер",
    "отказ клиента",
    "завершена",
    "ожидание подтверждения"
]

# Префиксы мобильных номеров по городам
CITY_PHONE_PREFIXES = {
    "Москва": ["495", "499", "496"],
    "Санкт-Петербург": ["812", "921", "911"],
    "Екатеринбург": ["343", "922", "912"],
    "Новосибирск": ["383", "923", "913"],
    "Казань": ["843", "917", "919"]
}

# Категории услуг
DEFAULT_CATEGORIES = [
    # Сантехника: Установка и монтаж
    "Установка душевой кабины",
    "Монтаж инсталляции",
    "Установка унитаза",
    "Установка ванны",
    "Монтаж бойлера",
    "Установка смесителя",
    "Установка раковины",
    "Монтаж батарей",
    # Разводка и коммуникации
    "Разводка труб ГВС/ХВС",
    "Пайка ПП труб",
    "Монтаж металлопласта",
    "Монтаж сшитого полиэтилена",
    "Установка теплых полов",
    # Комплексные услуги
    "Сантехника под ключ",
    # Дополнительные услуги
    "Остекление балконов",
    "Остекление лоджий",
    "Натяжные потолки",
    "Дизайн интерьера",
    "Кухни на заказ",
    "Ремонт квартир под ключ"
]

# Города (будут настраиваться через админ-панель)
DEFAULT_CITIES = [
    "Москва",
    "Санкт-Петербург",
    "Екатеринбург",
    "Новосибирск",
    "Казань"
]

# Настройки веб-сервера для админ-панели
ADMIN_HOST = "0.0.0.0"
ADMIN_PORT = 8000

# Настройки GitHub
GITHUB_SYNC_INTERVAL = 15  # Интервал синхронизации с GitHub в минутах 

# Security Settings
MAX_REQUESTS_PER_MINUTE = 10
MAX_WARNINGS = 3
BLOCK_DURATION_HOURS = 24

# Service Categories
SERVICES = {
    'Сантехника': {
        'Установка и монтаж': {
            'Душевая кабина': {'area_range': (1, 3), 'unit': 'м²'},
            'Инсталляции': {},
            'Унитаз': {'types': ['настенный', 'напольный']},
            'Ванна': {'types': ['встраиваемая', 'отдельностоящая']},
            'Бойлер': {'types': ['проточный', 'накопительный']},
            'Смеситель': {'types': ['настенный', 'напольный', 'встраиваемый']},
            'Раковина': {'types': ['подвесная', 'напольная']},
            'Батареи': {'types': ['чугунные', 'биметалл', 'алюминий']}
        },
        'Разводка и коммуникации': {
            'Трубы ГВС, ХВС': {},
            'Пайка ПП': {},
            'Металлопласт': {},
            'Сшитый полиэтилен': {},
            'Теплые полы': {'types': ['электро', 'водяные']}
        }
    },
    'Комплексные услуги': {
        'Сантехника под ключ': {
            'Полный монтаж коммуникаций': {},
            'Разводка теплых полов': {},
            'Установка сантехники': {}
        }
    },
    'Дополнительные услуги': {
        'Остекление': {
            'Балкон': {'area_range': (3, 10), 'unit': 'м²'},
            'Лоджия': {'area_range': (4, 15), 'unit': 'м²'}
        },
        'Натяжные потолки': {'area_range': (50, 150), 'unit': 'м²'},
        'Дизайн интерьера': {'area_range': (50, 180), 'unit': 'м²'},
        'Кухни на заказ': {'length_range': (2, 6), 'unit': 'метров'},
        'Ремонт квартир под ключ': {}
    }
}

# Service Packages
SERVICE_PACKAGES = [
    {
        'name': 'Сантехника + теплые полы',
        'services': ['Сантехника', 'Теплые полы']
    },
    {
        'name': 'Смеситель + ванная + душевая кабина',
        'services': ['Смеситель', 'Ванна', 'Душевая кабина']
    },
    {
        'name': 'Батареи + разводка ГВС/ХВС',
        'services': ['Батареи', 'Трубы ГВС, ХВС']
    },
    {
        'name': 'Полный ремонт',
        'services': ['Сантехника под ключ', 'Натяжные потолки', 'Остекление']
    }
] 